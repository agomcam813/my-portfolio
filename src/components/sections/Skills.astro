---
import Section from "@/components/Section.astro";
import cv from '../../../cv.json';

// Importar íconos
import JavaScriptIcon from '../../icons/javascript.astro';
import TypeScriptIcon from '../../icons/type.astro';
import HtmlIcon from '../../icons/html.astro';
import CssIcon from '../../icons/css.astro';
import TailwindIcon from '../../icons/tailwind.astro';
import NodeIcon from '../../icons/node.astro';
import ReactIcon from '../../icons/react.astro';
import Node from '../../icons/node.astro';
import GitIcon from '../../icons/git.astro';
import GitHubIcon from '../../icons/GitHub.astro';
import MySqlIcon from '../../icons/sql.astro';

// Mapa de íconos para las habilidades
const skillIcons = {
  'JavaScript': JavaScriptIcon,
  'TypeScript': TypeScriptIcon,
  'HTML': HtmlIcon,
  'CSS': CssIcon,
  'Tailwind': TailwindIcon,
  'Node': NodeIcon,
  'React': ReactIcon,
  'Next.js': Node,
  'Git': GitIcon,
  'GitHub': GitHubIcon,
  'MySQL': MySqlIcon
};

// Extraer datos del CV
const { skills = [], languages = [], interests = [], awards = [], certificates = [] } = cv;

// Función para agrupar habilidades por categoría
function groupSkills(skills) {
  const categories = {};
  
  skills.forEach(skill => {
    const category = skill.category || 'Otras Habilidades';
    if (!categories[category]) {
      categories[category] = [];
    }
    categories[category].push(skill);
  });
  
  return categories;
}

const skillCategories = groupSkills(skills);
const allCertificates = [...(certificates || []), ...(awards || [])].sort((a, b) => 
  new Date(b.date || 0).getTime() - new Date(a.date || 0).getTime()
);

// Función para el retraso de animación
const getDelay = (index, base = 0) => `${base + (index * 50)}ms`;
---

<Section title="Habilidades">
    <div class="grid grid-cols-1 md:grid-cols-2 gap-12">
        {/* Columna izquierda - Habilidades técnicas */}
        <div class="space-y-10">
            {/* Habilidades técnicas */}
            <div>
                <h3 class="text-2xl font-bold text-white mb-6">
                    Habilidades Técnicas
                </h3>
                
                <div class="space-y-8">
                    {Object.entries(skillCategories).map(([category, skills], index) => (
                        <div key={category} data-animate-on-load style={`--delay: ${getDelay(index, 100)}`}>
                            <h4 class="text-lg font-medium text-gray-300 mb-3">
                                {category}
                            </h4>
                            <div class="flex flex-wrap gap-2">
                                {skills.map((skill, skillIndex) => (
                                    <span 
                                        key={skill.name}
                                        class="px-3 py-1.5 bg-gray-800 rounded-full text-sm text-gray-200 border border-gray-700 hover:bg-accent/10 hover:border-accent/30 hover:text-accent transition-colors flex items-center gap-2"
                                        title={skill.name}
                                    >
                                        {skillIcons[skill.name] ? (
                                            <span class="w-4 h-4 flex-shrink-0">
                                                <skillIcons[skill.name] />
                                            </span>
                                        ) : (
                                            <span class="w-4 h-4 flex-shrink-0"></span>
                                        )}
                                        <span class="truncate max-w-[100px]">
                                            {skill.name}
                                        </span>
                                    </span>
                                ))}
                            </div>
                        </div>
                    ))}
                </div>
            </div>
        </div>
        
        {/* Columna derecha - Idiomas y más */}
        <div class="space-y-10">
            {/* Idiomas */}
            {languages && languages.length > 0 && (
                <div data-animate-on-load style="--delay: 100ms">
                    <h3 class="text-2xl font-bold text-white mb-6">
                        Idiomas
                    </h3>
                    
                    <div class="space-y-4">
                        {languages.map((lang, index) => {
                            const proficiency = lang.fluency === 'Native' ? '100%' : 
                                             lang.fluency === 'Fluent' ? '90%' : 
                                             lang.fluency === 'Intermediate' ? '70%' : '50%';
                            
                            return (
                                <div key={lang.language} class="mb-4">
                                    <div class="flex justify-between text-sm mb-1">
                                        <span class="font-medium text-gray-200">
                                            {lang.language}
                                        </span>
                                        <span class="text-gray-400">{lang.fluency}</span>
                                    </div>
                                    <div class="w-full bg-gray-800/30 rounded-full h-2 overflow-hidden">
                                        <div 
                                            class="bg-gradient-to-r from-accent to-accent/70 h-2 rounded-full" 
                                            style={`width: ${proficiency};`}
                                        ></div>
                                    </div>
                                </div>
                            );
                        })}
                    </div>
                </div>
            )}
            
            {/* Intereses */}
            {interests && interests.length > 0 && (
                <div data-animate-on-load style="--delay: 200ms">
                    <h3 class="text-2xl font-bold text-white mb-6">
                        Intereses
                    </h3>
                    
                    <div class="flex flex-wrap gap-2">
                        {interests.map((interest, index) => (
                            <span 
                                key={interest}
                                class="px-3 py-1 bg-gray-800/50 rounded-full text-sm text-gray-200 border border-gray-700/50 hover:bg-accent/10 hover:border-accent/30 hover:text-accent transition-colors"
                            >
                                {interest}
                            </span>
                        ))}
                    </div>
                </div>
            )}
            
            {/* Certificaciones y premios */}
            {allCertificates.length > 0 && (
                <div data-animate-on-load style="--delay: 300ms">
                    <h3 class="text-2xl font-bold text-white mb-6">
                        Certificaciones y Premios
                    </h3>
                    
                    <div class="space-y-4">
                        {allCertificates.map((cert, index) => (
                            <div 
                                key={`${cert.name}-${index}`}
                                class="relative pl-5 border-l-2 border-gray-800 hover:border-accent/50 transition-colors py-2"
                            >
                                <div class="absolute -left-[9px] top-4 w-3 h-3 rounded-full bg-gray-900 border-2 border-accent"></div>
                                
                                <h4 class="font-medium text-gray-200">
                                    {cert.name || cert.title}
                                </h4>
                                {cert.issuer && (
                                    <div class="text-sm text-gray-400 mt-1">{cert.issuer}</div>
                                )}
                                {cert.date && (
                                    <div class="text-xs text-gray-500 mt-1">
                                        {new Date(cert.date).toLocaleDateString('es-ES', { year: 'numeric', month: 'long' })}
                                    </div>
                                )}
                            </div>
                        ))}
                    </div>
                </div>
            )}
        </div>
    </div>
</Section>

<script>
    // Animar elementos al hacer scroll
    document.addEventListener('astro:page-load', () => {
        // Añadir clase al body cuando la página esté lista
        document.documentElement.classList.add('js-interactive');
        
        // Animar elementos al hacer scroll
        const animateOnScroll = (entries, observer) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    entry.target.style.opacity = '1';
                    entry.target.style.transform = 'translateY(0)';
                    observer.unobserve(entry.target);
                }
            });
        };
        
        const observer = new IntersectionObserver(animateOnScroll, {
            threshold: 0.1,
            rootMargin: '0px 0px -50px 0px'
        });
        
        document.querySelectorAll('[data-animate-on-load]').forEach(el => {
            observer.observe(el);
        });
    });
</script>

<style>
    /* Animaciones personalizadas */
    [data-animate-on-load] {
        opacity: 0;
        transform: translateY(20px);
        transition: opacity 0.6s ease-out, transform 0.6s ease-out;
        transition-delay: var(--delay, 0ms);
    }
    
    .js-interactive [data-animate-on-load] {
        opacity: 1;
        transform: translateY(0);
    }
    
    /* Custom scrollbar */
    ::-webkit-scrollbar {
        width: 6px;
        height: 6px;
    }
    
    ::-webkit-scrollbar-track {
        background: rgba(255, 255, 255, 0.05);
        border-radius: 3px;
    }
    
    ::-webkit-scrollbar-thumb {
        background: rgba(255, 255, 255, 0.1);
        border-radius: 3px;
    }
    
    ::-webkit-scrollbar-thumb:hover {
        background: rgba(255, 255, 255, 0.2);
    }
</style>